---
title: Objectives UI
description: Sistema UI per visualizzare obiettivi e carte
---

## Architettura

### Approccio Ibrido C++/Blueprint
- **C++ Base Classes** - Logica, sicurezza, performance
- **Blueprint Widgets** - Design visivo, animazioni, stile

**Vantaggi:**
âœ… Type-safe data binding
âœ… Logica testabile in C++
âœ… FlessibilitÃ  artistica in BP
âœ… Auto-update senza polling

---

## Componenti

### 1. ObjectivesPanelWidget
**Pannello principale** contenente tutti gli obiettivi.

**ResponsabilitÃ :**
- Si connette al PlayerState locale
- Crea dinamicamente le carte obiettivo
- Ascolta `OnObjectivesUpdated` event
- Refresh automatico quando obiettivi cambiano

**Widget Bindings (Blueprint):**
```
MainObjectiveCard (UObjectiveCardWidget)
SecondaryCardsContainer (UScrollBox)
SecondariesTitle (UTextBlock)
```

**Flusso Inizializzazione:**
```
NativeConstruct()
â†“
InitializePanel()
â†“
Get PlayerState locale
â†“
Bind OnObjectivesUpdated event
â†“
Se obiettivi giÃ  assegnati â†’ Popola UI
Se non ancora â†’ Nasconde, aspetta evento
```

**Auto-Update:**
```
PlayerState riceve obiettivi da server
â†“
OnRep_MainObjective/SecondaryObjectives
â†“
Broadcast OnObjectivesUpdated
â†“
ObjectivesPanelWidget.OnPlayerObjectivesUpdated()
â†“
InitializePanel() o RefreshAllCards()
```

**Configurazione:**
```cpp
SecondaryCardClass;        // Classe carta da creare
CardSpacing = 10.0f;       // Spazio tra carte (px)
AutoUpdateInterval = 0.5f; // Polling fallback (sec)
```

---

### 2. ObjectiveCardWidget
**Singola carta obiettivo** (principale o secondario).

**ResponsabilitÃ :**
- Mostra dati di un FAssignedObjective
- Refresh quando stato cambia
- Animazioni completamento
- Stile diverso per tipo (main/secondary)

**Widget Bindings (Blueprint):**
```
DisplayNameText (UTextBlock)     - Nome obiettivo
DescriptionText (UTextBlock)     - Descrizione
TypeText (UTextBlock)            - "PRINCIPALE" o "SECONDARIO"
CompletionIcon (UImage)          - Icona check quando completato
CardBorder (UBorder)             - Bordo (cambia colore)
VictoryPointsText (UTextBlock)   - Punti (solo secondari)
VictoryPointsBox (UHorizontalBox) - Container punti
```

**Colori Configurabili:**
```cpp
MainObjectiveColor = Oro
SecondaryObjectiveColor = Argento
NormalColor = Grigio
CompletedColor = Verde
```

**Metodi:**
```cpp
SetObjectiveData(Objective, bIsMain);  // Imposta dati
RefreshDisplay();                       // Refresh UI
OnObjectiveCompleted();                 // Event BP per animazioni
```

---

### 3. VictoryPointsWidget
**Display punti vittoria** sempre visibile nell'HUD.

**ResponsabilitÃ :**
- Mostra punteggio corrente del giocatore
- Si aggiorna automaticamente ogni 0.5s
- Cambio colore dinamico basato su soglie

**Widget Bindings (Blueprint):**
```
PointsText (UTextBlock)  - Numero punti
PointsIcon (UImage)      - Icona stella
```

**Colori Dinamici:**
```cpp
0-2 pt   â†’ Grigio   (pochi punti)
3-5 pt   â†’ Bianco   (medio)
6-8 pt   â†’ Giallo   (buono)
9+ pt    â†’ Oro      (ottimo)
```

**Auto-Update:**
Polling ogni `UpdateInterval` secondi.
Legge `PlayerState->GetTotalVictoryPoints()`.

---

### 4. ObjectiveNotificationWidget
**Popup animato** quando completi un obiettivo.

**ResponsabilitÃ :**
- Mostra notifica "Obiettivo Completato!"
- Animazione entrata/uscita
- Suono/feedback
- Auto-rimozione dopo N secondi

**Widget Bindings (Blueprint):**
```
TitleText (UTextBlock)         - "Obiettivo Completato!"
ObjectiveNameText (UTextBlock) - Nome obiettivo
PointsText (UTextBlock)        - "+X Punti Vittoria"
IconImage (UImage)             - Icona check
```

**Configurazione:**
```cpp
DisplayDuration = 3.0f;     // Secondi prima di scomparire
CompletionSound;            // Sound asset
SlideInAnimation;           // UWidgetAnimation
SlideOutAnimation;          // UWidgetAnimation
```

**Flusso:**
```
PlayerState obiettivo completato
â†“
ObjectivesPanel rileva cambio
â†“
Broadcast OnObjectiveCompleted
â†“
GameHUD in ascolto
â†“
Crea ObjectiveNotificationWidget
â†“
Aggiunge a viewport
â†“
Play SlideInAnimation + Suono
â†“
Timer 3 secondi
â†“
Play SlideOutAnimation
â†“
Remove da viewport
```

---

## Event Flow

### Caso 1: Assegnazione Iniziale
```
Server assegna obiettivi
â†“
Replicazione a client (COND_OwnerOnly)
â†“
OnRep_MainObjective/SecondaryObjectives
â†“
Broadcast OnObjectivesUpdated
â†“
ObjectivesPanelWidget riceve evento
â†“
InitializePanel()
â†“
Crea MainObjectiveCard
â†“
Crea N SecondaryCards dinamicamente
â†“
Pannello visibile e popolato
```

### Caso 2: Completamento Obiettivo
```
Server marca obiettivo completato
â†“
Replicazione cambio bCompleted
â†“
OnRep triggera OnObjectivesUpdated
â†“
ObjectivesPanelWidget.UpdateObjectivesStatus()
â†“
Rileva cambio stato
â†“
Refresh ObjectiveCardWidget
â†“
Carta cambia colore, mostra icona check
â†“
Broadcast OnObjectiveCompleted
â†“
GameHUD crea notifica popup
```

---

## Implementazione Blueprint

### BP_ObjectivesPanelWidget
```
Parent Class: ObjectivesPanelWidget (C++)

Designer:
  â€¢ Canvas Panel (root)
    â€¢ Vertical Box
      â€¢ Text "OBIETTIVI" (titolo)
      â€¢ BP_ObjectiveCardWidget (MainObjectiveCard)
      â€¢ Text "Secondari" (SecondariesTitle)
      â€¢ Scroll Box (SecondaryCardsContainer)

Class Defaults:
  â€¢ Secondary Card Class = BP_ObjectiveCardWidget
  â€¢ Card Spacing = 10
  â€¢ Auto Update Interval = 0.5
```

### BP_ObjectiveCardWidget
```
Parent Class: ObjectiveCardWidget (C++)

Designer:
  â€¢ Border (CardBorder) - Bordo colorato
    â€¢ Vertical Box
      â€¢ Text Block (TypeText) - "PRINCIPALE"/"SECONDARIO"
      â€¢ Text Block (DisplayNameText) - Nome
      â€¢ Text Block (DescriptionText) - Descrizione
      â€¢ Horizontal Box (VictoryPointsBox)
        â€¢ Image (stella)
        â€¢ Text Block (VictoryPointsText) - "3 pt"
      â€¢ Image (CompletionIcon) - Check verde

Animations:
  â€¢ Completed_Anim - Scale pulse, color shift

Event Graph:
  â€¢ OnObjectiveCompleted â†’ Play Completed_Anim
```

---

## Performance

**Zero Tick:**
Nessun widget fa tick continuo. Solo event-driven.

**Lazy Creation:**
Carte secondarie create solo quando servono.

**Smart Update:**
Refresh solo se `bCompleted` effettivamente cambiato.

**Memory:**
~4KB per carta obiettivo. Max ~20KB per player.

---

## Stato Implementazione

âœ… Completato:
- Tutti i 4 widget base C++
- Sistema auto-update
- Event dispatcher
- RepNotify integration
- Documentazione completa (650+ righe)

ðŸ”§ Da fare:
- Design visivo definitivo
- Animazioni avanzate
- Localizzazione testi
- AccessibilitÃ  (scaling UI)
